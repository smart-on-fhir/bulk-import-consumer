<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <link rel="icon" href="/smart-logo.png" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content="Bulk Data Import Server (reference implementation)" />
        <link rel="apple-touch-icon" href="/smart-logo.png" />
        <title>Bulk Data Import Server</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    </head>
    <body>
        <noscript>You need to enable JavaScript to run this app.</noscript>
        <header>
            <br/>
            <h1 class="container">
                <img src="/smart-logo.png" style="width:48px;vertical-align: bottom;" alt="SMART Logo" />
                Bulk Data Import Server
            </h1>
            <hr/>
        </header>
        <div id="root" class="container-lg">

            <section id="registration-section">
                <h2 class="text-primary">Client Registration</h2>
                <p>
                    Use this form to register new client. Upon successful registration you will be given a <code>client_id</code>
                    and information on how to connect.
                </p>
                <form autocomplete="off">
                    <fieldset class="mb-3 mt-4">
                        <legend>Public Key</legend>
                        <div class="row mt-3" style="min-height: 8rem;">
                            <div class="col-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="keyType" id="keyTypeJWKS">
                                    <label class="form-check-label" for="keyTypeJWKS">Provide the key now</label>
                                    <div class="form-text">Provide your public key as JWK</div>
                                </div>
                                <div class="form-check me-5">
                                    <input class="form-check-input" type="radio" name="keyType" id="keyTypeJWKSURL" checked>
                                    <label class="form-check-label" for="keyTypeJWKSURL">Fetch the key from JWKS URL</label>
                                    <div class="form-text">Provide an URL to your JWKS containing your public key(s)</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div id="form-section-jwks">
                                    <label for="jwk">Public Key <span class="text-muted">(as JWK)</span></label>
                                    <textarea id="jwk" class="form-control" rows="3" style="font-family: monospace; font-size: 14px;" spellcheck="false"></textarea>
                                    <div class="invalid-feedback">Invalid JWK</div>
                                </div>
                                <div id="form-section-jwks-url">
                                    <label for="jwks_uri">JWKS URL</label>
                                    <input type="url" id="jwks_uri" class="form-control" placeholder="https://....json"/>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <fieldset class="mb-3 mt-4">
                        <legend>
                            <label>
                                <input type="checkbox" class="form-check-input" id="show-generator"> Show Key Generator
                            </label>
                        </legend>
                        <div class="alert alert-warning" id="generator" style="display: none;">
                            <b>NOTE:</b> You should generate keys yourself and never trust a website to do that! However, since this
                            is a tool for development and testing, we also provide a key generator. We do not store these
                            keys anywhere, and yet you should never use them in production!
                            <div class="row mt-3 mb-3">
                                <label class="col-form-label col-auto">Algorithm:</label>
                                <div class="col-auto">
                                    <select class="form-control" id="alg">
                                        <option value="RS256">RS256</option>
                                        <option value="RS384">RS384 (recommended)</option>
                                        <option value="RS512">RS512</option>
                                        <option value="ES256">ES256</option>
                                        <option value="ES384">ES384 (recommended)</option>
                                        <option value="ES512">ES512</option>
                                    </select>
                                </div>
                                <label class="col-auto text-end col-form-label ps-5">View as:</label>
                                <div class="col-auto text-end">
                                    <input type="radio" class="btn-check" data-value="jwk" name="generated-key-type" id="generated-key-type-jwk" autocomplete="off" checked>
                                    <label class="btn btn-outline-secondary" for="generated-key-type-jwk">JWK</label>
                                    
                                    <input type="radio" class="btn-check" data-value="pem" name="generated-key-type" id="generated-key-type-pem" autocomplete="off">
                                    <label class="btn btn-outline-secondary" for="generated-key-type-pem">PEM</label>
                                </div>
                                <div class="col text-end">
                                    <button type="button" id="generate" class="btn btn-success">Generate Keys</button>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <label for="generated-public-key">Public Key</label>
                                    <textarea id="generated-public-key" class="form-control" style="font-family: monospace; font-size: 14px;" rows="6" spellcheck="false" readonly></textarea>
                                    <div class="form-text"><button class="btn btn-sm btn-outline-success" type="button" id="paste-key">Paste</button> this key (as JWK) in the <code>Public Key</code> text box above</div>
                                </div>
                                <div class="col">
                                    <label for="generated-private-key">Private Key</label>
                                    <textarea id="generated-private-key" class="form-control" style="font-family: monospace; font-size: 14px;" rows="6" spellcheck="false" readonly></textarea>
                                    <div class="form-text">Use this key in your client app to sign tokens</div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <hr/>
                    <p class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg">Register</button>
                    </p>
                </form>
            </section>

            <section id="client-section">
                <h2 class="text-success mt-5 mb-5">Client Registration Completed!</h2>
                <div class="row mt-5 mb-5">
                    <div class="col">
                        <label>Your <code>client_id</code></label>
                        <div class="form-text">Use this in your token requests</div>
                        <input type="text" readonly id="client_id" class="form-control"/>
                    </div>
                    <div class="col">
                        <label>Token URL</label>
                        <div class="form-text">Authorize against this endpoint</div>
                        <input type="text" readonly id="token_endpoint" class="form-control"/>
                    </div>
                </div>
                <div class="mt-5 mb-5">
                    <hr/>
                    <br/>
                    <p class="text-center">
                        <button id="clear-client" type="button" class="btn btn-secondary">Register another Client</button>
                    </p>
                </div>
            </section>
            
            <!-- <br/>
            To authorize against this server create a token like this:
            <pre>
            {
                iss: "your client_id",
                sub: "your client_id",
                aud: "https://dasdasda",
                exp: {expiration timestamp},
                jti: "random ID string"
            }
            </pre> -->
            <br />
        </div>
        <script src="/js/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script src="/js/lib.js"></script>
    </body>
</html>
